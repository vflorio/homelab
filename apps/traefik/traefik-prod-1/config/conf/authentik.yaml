# Authentik ForwardAuth Middleware Configuration
# Place this in /apps/traefik/traefik-prod-1/config/conf/

http:
  middlewares:
    # Authentik Forward Auth Middleware
    authentik:
      forwardAuth:
        address: "http://authentik-outpost-prod-1:9000/outpost.goauthentik.io/auth/traefik"
        trustForwardHeader: true
        authResponseHeaders:
          - X-authentik-username
          - X-authentik-groups
          - X-authentik-email
          - X-authentik-name
          - X-authentik-uid
          - X-authentik-jwt
          - X-authentik-meta-jwks
          - X-authentik-meta-outpost
          - X-authentik-meta-provider
          - X-authentik-meta-app
          - X-authentik-meta-version

    # Optional: Authentik Auth for Traefik Dashboard
    authentik-dashboard:
      forwardAuth:
        address: "http://authentik-outpost-prod-1:9000/outpost.goauthentik.io/auth/traefik"
        trustForwardHeader: true
        authResponseHeaders:
          - X-authentik-username
          - X-authentik-groups
          - X-authentik-email

  # Router esempio per applicazioni protette
  routers:
    # Dashboard Traefik protetto con Authentik
    traefik-dashboard:
      rule: "Host(`traefik.srv-prod-1.intranet.vflorio.com`)"
      entrypoints:
        - websecure
      service: api@internal
      middlewares:
        - authentik-dashboard
      tls:
        certResolver: cloudflare